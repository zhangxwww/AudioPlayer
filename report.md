# 说明文档——音乐播放器

金昕琪 2016010524

汪元标 2016010327

张欣炜 2016010151

---

## 开发环境

Win10 + Visual Studio 2019 + masm + Irvine

## 代码说明

main.asm中实现了GUI窗口，以及各种交互事件的逻辑处理。PlayerKernel.asm中实现了音频与歌词相关的各种操作。cmd.asm是一个命令行版的demo。main.asm与cmd.asm不能同时参与生成。

## 实现原理

- 音频文件播放相关

  使用了winmm.lib中的`mciSendString`函数，通过该函数发送不同的命令，实现播放、暂停、跳转、调整音量等音乐播放器的基础操作。支持wav, mp3, m4a, mid等多种音频格式。

## GUI介绍

## 难点与创新点

- 对音频文件的操作

  最开始我打算自己实现对声卡以及各种音频文件的解析与操作。但是通过查阅资料，了解各种音频格式与压缩算法之后，我认为自己实现起来工作量会难以控制，有可能无法按时完成。因此我决定查找windows是否提供了相应的API来完成对应的操作。

  这一部分代码写出来不算复杂，但是搜集资料的过程非常困难。主要原因在于masm的社区不够活跃，难以找到有效的信息。最开始找到了`PlaySound`这个API，但是这个API提供的操作非常有限，只能做到播放与停止，同时仅支持wav格式音频。这显然不能满足我们音乐播放器的需求。

  经过了大量的查阅资料后，我找到了`mciSendString`这一API。经过测试，这一API可以完成我们需要的全部操作，同时支持多种常见音频格式。因此我们选择利用这一API完成对音频的各种操作。

- 播放进度条

- 播放列表、切歌与循环

## 分工 

- 张欣炜对音乐播放器的实现方案进行了前期的调研与踩坑。完成了对音频文件的各种操作的封装，实现了一个简单的命令行版的demo。
- 汪元标完成了GUI的设计，以及GUI交互时的各种逻辑。
- 金昕琪完成了播放列表与切歌功能，为GUI添加细节，并完善了程序对异常的处理。